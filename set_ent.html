<html>
<body>
<?php
  $db = pg_connect("host=usfr-itdocument.insideidc.com dbname=cmdocument user=cmdocument password=h0twheels") or die('Could not connect');
  if (isset($_POST['vend_id'])) {$vend_id = pg_escape_string($_POST['vend_id']);}
  if (isset($_POST['vend'])) {$vend = pg_escape_string($_POST['vend']);}
  if (isset($_POST['contact_id'])) {$contact_id = pg_escape_string($_POST['contact_id']);}
  if (isset($_POST['contact_firstname'])) {$contact_firstname = pg_escape_string($_POST['contact_firstname']);}
  if (isset($_POST['contact_lastname'])) {$contact_lastname = pg_escape_string($_POST['contact_lastname']);}
  if (isset($_POST['contact_company'])) {$contact_company = pg_escape_string($_POST['contact_company']);}
  if (isset($_POST['contact_phone'])) {$contact_phone = pg_escape_string($_POST['contact_phone']);}
  if (isset($_POST['contact_website'])) {$contact_website = pg_escape_string($_POST['contact_website']);}
  if (isset($_POST['contact_user'])) {$contact_user = pg_escape_string($_POST['contact_user']);}
  if (isset($_POST['contact_pass'])) {$contact_pass = pg_escape_string($_POST['contact_pass']);}
  if (isset($_POST['contact_email'])) {$contact_email = pg_escape_string($_POST['contact_email']);}
  if (isset($_POST['contact_address'])) {$contact_address = pg_escape_string($_POST['contact_address']);}
  if (isset($_POST['contact_notes'])) {$contact_notes = pg_escape_string($_POST['contact_notes']);}
  if (isset($_POST['referer'])) {$ref = pg_escape_string($_POST['referer']);}
//edit-add handler
  if (isset($ref)) {
    if ($ref=="edt_vendor.html") {
      pg_query($db, "UPDATE cmd_vendors SET vend='$vend' WHERE vend_id=$vend_id");
      echo 'Edited Vendor.' . '<br />';
    }
    else if ($ref=="edt_contact.html") {
      pg_query($db, "UPDATE cmd_contacts SET contact_firstname='$contact_firstname',contact_lastname='$contact_lastname',contact_company='$contact_company',contact_phone='$contact_phone',contact_website='$contact_website',contact_user='$contact_user',contact_pass='$contact_pass',contact_email='$contact_email',contact_address='$contact_address',contact_notes='$contact_notes' WHERE contact_id=$contact_id");
      echo 'Edited Contact.' . '<br />';
    }
    else if ($ref=="add_vendor.html") {
      pg_query($db, "INSERT INTO cmd_vendors(vend) VALUES('$vend')");
      echo 'Added Vendor.' . '<br />';
    }
    else if ($ref=="add_contact.html") {
      pg_query($db, "INSERT INTO cmd_contacts(contact_firstname, contact_lastname, contact_company, contact_phone, contact_website, contact_user, contact_pass, contact_email, contact_address, contact_notes) VALUES('$contact_firstname', '$contact_lastname', '$contact_company', '$contact_phone', '$contact_website', '$contact_user', '$contact_pass', '$contact_email', '$contact_address', '$contact_notes')");
      echo 'Added Contact.' . '<br />';
    }
  }


  $qry_vendor = pg_query($db, "SELECT * FROM cmd_vendors ORDER BY vend ASC");
  $qry_contact = pg_query($db, "SELECT * FROM cmd_contacts ORDER BY contact_company ASC,contact_lastname ASC");
?>
<table>
  <tr>
    <td><b>Settings</b></td>
  </tr>
  <table>
    <tr>
      <td><b><a href="set_gen.html">General</a></b></td>
      <td><b><a href="set_hw.html">Hardware</a></b></td>
      <td><b><a href="set_sw.html">Software</a></b></td>
      <td><b><a href="set_loc.html">Locations</a></b></td>
      <td><b><i><a href="set_ent.html">Entities</a></i></b></td>
    </tr>
  </table>
  <table>
    <tr>
      <td>
        <table>
          <tr>
            <td><b>Vendors</b></td>
            <td><b>Edit</b></td>
            <td><b>Delete</b></td>
            <td>
              <form id="add_vendor" method="post">
                <input type="hidden" name="referer" value="set_ent.html">
                <input type="image" src="img/add.png" value="" onclick="document.getElementById('add_vendor').action='add_vendor.html';">
              </form>
            </td>
          </tr>
            <?php
              echo "\r\n";
              while ($vendrow = pg_fetch_assoc($qry_vendor)) {
                echo '            <tr>' . "\r\n" . '              <form id="vendor' . $vendrow['vend_id'] . '" method="post">' . "\r\n" . '                <input type="hidden" name="referer" value="set_ent.html">' . "\r\n" . '                <input type="hidden" name="vend_id" value="' . $vendrow['vend_id'] . '">' . "\r\n" . '                <input type="hidden" name="vend" value="' . $vendrow['vend'] . '">' . "\r\n" . '                <td>' . $vendrow['vend'] . '</td>' . "\r\n" . '                <td>' . '<input type="image" src="img/edit.png" value="" onclick="document.getElementById(\'vendor' . $vendrow['vend_id'] . '\').action =\'edt_vendor.html\';"'  . '>' . '</td>' . "\r\n" . '                <td>' . '<input type="image" src="img/delete.png" value="" onclick="document.getElementById(\'vendor' . $vendrow['vend_id'] . '\').action =\'del_vendor.php\';"' . '>' . '</td>' . "\r\n" . '              </form>' . "\r\n"  . '            </tr>' . "\r\n";
              }
            ?>
        </table>
      </td>
    </tr>
    <tr>
      <td>
        <table>
          <tr>
            <td><b>Contacts</b></td>
            <td><b>Edit</b></td>
            <td><b>Delete</b></td>
            <td>
              <form id="add_contact" method="post">
                <input type="hidden" name="referer" value="set_ent.html">
                <input type="image" src="img/add.png" value="" onclick="document.getElementById('add_contact').action='add_contact.html';">
              </form>
            </td>
          </tr>
            <?php
              echo "\r\n";
              while ($contactrow = pg_fetch_assoc($qry_contact)) {
                echo '            <tr>' . "\r\n" . '              <form id="contact' . $contactrow['contact_id'] . '" method="post">' . "\r\n" . '                <input type="hidden" name="referer" value="set_ent.html">' . "\r\n" . '                <input type="hidden" name="contact_id" value="' . $contactrow['contact_id'] . '">' . "\r\n" . '                <input type="hidden" name="contact_firstname" value="' . $contactrow['contact_firstname'] . '">' . "\r\n" . '                <input type="hidden" name="contact_lastname" value="' . $contactrow['contact_lastname'] . '">' . "\r\n" . '                <input type="hidden" name="contact_company" value="' . $contactrow['contact_company'] . '">' . "\r\n" . '                <input type="hidden" name="contact_phone" value="' . $contactrow['contact_phone'] . '">' . "\r\n" . '                <input type="hidden" name="contact_website" value="' . $contactrow['contact_website'] . '">' . "\r\n" . '                <input type="hidden" name="contact_user" value="' . $contactrow['contact_user'] . '">' . "\r\n" . '                <input type="hidden" name="contact_pass" value="' . $contactrow['contact_pass'] . '">' . "\r\n" . '                <input type="hidden" name="contact_email" value="' . $contactrow['contact_email'] . '">' . "\r\n" . '                <input type="hidden" name="contact_address" value="' . $contactrow['contact_address'] . '">' . "\r\n" . '                <input type="hidden" name="contact_notes" value="' . $contactrow['contact_notes'] . '">' . "\r\n" . '                <td>' . $contactrow['contact_company'] . ' - ' . $contactrow['contact_lastname'] . ', ' . $contactrow['contact_firstname'] . '</td>' . "\r\n" . '                <td>' . '<input type="image" src="img/edit.png" value="" onclick="document.getElementById(\'contact' . $contactrow['contact_id'] . '\').action =\'edt_contact.html\';"'  . '>' . '</td>' . "\r\n" . '                <td>' . '<input type="image" src="img/delete.png" value="" onclick="document.getElementById(\'contact' . $contactrow['contact_id'] . '\').action =\'del_contact.php\';"' . '>' . '</td>' . "\r\n" . '              </form>' . "\r\n"  . '            </tr>' . "\r\n";
              }
            ?>
        </table>
      </td>
    </tr>
  </table>
</table>
</body>
</html>
