<html>
<body>

<?php
  $db = pg_connect("host=usfr-itdocument.insideidc.com dbname=cmdocument user=cmdocument password=h0twheels") or die('Could not connect');
  if (isset($_POST['priority_id'])) {$priority_id = pg_escape_string($_POST['priority_id']);}
  if (isset($_POST['priority'])) {$priority = pg_escape_string($_POST['priority']);}
  if (isset($_POST['purpose_id'])) {$purpose_id = pg_escape_string($_POST['purpose_id']);}
  if (isset($_POST['purpose'])) {$purpose = pg_escape_string($_POST['purpose']);}
  if (isset($_POST['status_id'])) {$status_id = pg_escape_string($_POST['status_id']);}
  if (isset($_POST['status'])) {$status = pg_escape_string($_POST['status']);}
  if (isset($_POST['referer'])) {$ref = pg_escape_string($_POST['referer']);}
//edit-add handler
  if (isset($ref)) {
    if ($ref=="edt_priority.html") {
      pg_query($db, "UPDATE cmd_priority SET priority='$priority' WHERE priority_id=$priority_id");
      echo 'Edited Priority value: ' . $priority . '<br />';
    }
    else if ($ref=="edt_purpose.html") {
      pg_query($db, "UPDATE cmd_purpose SET purpose='$purpose' WHERE purpose_id=$purpose_id");
      echo 'Edited Purpose value: ' . $purpose . '<br />';
    }
    else if ($ref=="edt_status.html") {
      pg_query($db, "UPDATE cmd_status SET status='$status' WHERE status_id=$status_id");
      echo 'Edited Status value: ' . $status . '<br />';
    }
    else if ($ref=="add_priority.html") {
      pg_query($db, "INSERT INTO cmd_priority(priority) VALUES('$priority')");
      echo 'The Priority was added successfully with value: ' . $priority . '<br />';
    }
    else if ($ref=="add_purpose.html") {
      pg_query($db, "INSERT INTO cmd_purpose(purpose) VALUES('$purpose')");
      echo 'The Purpose was added successfully with value: ' . $purpose . '<br />';
    }
    else if ($ref=="add_status.html") {
      pg_query($db, "INSERT INTO cmd_status(status) VALUES('$status')");
      echo 'The Status was added successfully with value: ' . $status . '<br />';
    
    }
  }
  $qry_pri = pg_query($db, "SELECT * FROM cmd_priority ORDER BY priority ASC");
  $qry_stat = pg_query($db, "SELECT * FROM cmd_status ORDER BY status ASC");
  $qry_purp = pg_query($db, "SELECT * FROM cmd_purpose ORDER BY purpose ASC");
?>

<table>
  <tr>
    <td><b>Settings</b></td>
  </tr>
  <table>
    <tr>
      <td><b><i><a href="set_gen.html">General</a></i></b></td>
      <td><b><a href="set_hw.html">Hardware</a></b></td>
      <td><b><a href="set_sw.html">Software</a></b></td>
      <td><b><a href="set_loc.html">Locations</a></b></td>
      <td><b><a href="set_ent.html">Entities</a></b></td>
    </tr>
  </table>
  <table>
    <tr>
      <td>
        <table>
          <tr>
            <td><b>Priority Ratings</b></td>
            <td><b>Edit</b></td>
            <td><b>Delete</b></td>
            <td><form id="add_priority" method="post"><input type="hidden" name="referer" value="set_gen.html"><input type="image" src="img/add.png" value="" onclick="document.getElementById('add_priority').action='add_priority.html';"></form></td>
          </tr>
          <?php
            while ($prirow = pg_fetch_assoc($qry_pri)) {
                echo "\r\n" . '          <form id="priority' . $prirow['priority_id'] . '" method="post">' . "\r\n" . '            <input type="hidden" name="referer" value="set_gen.html">';
                echo "\r\n" . '            <tr>' . "\r\n" . '              <td>' . $prirow['priority'] . '</td>' . "\r\n" . '                <input type="hidden" name="priority_id" value="' . $prirow['priority_id'] . '">' . "\r\n" . '                <input type="hidden" name="priority" value="' . $prirow['priority'] . '">' . "\r\n";
                echo '            <td>' . '<input type="image" src="img/edit.png" value="" onclick="document.getElementById(\'priority' . $prirow['priority_id'] . '\').action =\'edt_priority.html\';"' . '>' . '</td>' . "\r\n";
                echo '            <td>' . '<input type="image" src="img/delete.png" value="" onclick="document.getElementById(\'priority' . $prirow['priority_id'] . '\').action =\'del_priority.php\';"' . '>' . '</td>' . "\r\n" .  '          </tr>' ;
                echo "\r\n" . '          </form>';
            }
          
          ?>

        </table>
      </td>
    </tr>
    <tr>
      <td>
        <table>
          <tr>
            <td><b>Purpose/System</b></td>
            <td><b>Edit</b></td>
            <td><b>Delete</b></td>
            <td><form id="add_purpose" method="post"><input type="hidden" name="referer" value="set_gen.html"><input type="image" src="img/add.png" value="" onclick="document.getElementById('add_purpose').action = 'add_purpose.html';"></form></td>
          </tr>
          <?php
            while ($purprow = pg_fetch_assoc($qry_purp)) {
                echo "\r\n" . '          <form id="purpose' . $purprow['purpose_id'] . '" method="post">' . "\r\n" . '            <input type="hidden" name="referer" value="set_gen.html">';
                echo "\r\n" . '          <tr>' . "\r\n" . '            <td>' . $purprow['purpose'] . '</td>' . "\r\n" . '                <input type="hidden" name="purpose_id" value="' . $purprow['purpose_id'] . '">' . "\r\n" . '                <input type="hidden" name="purpose" value="' . $purprow['purpose'] . '">' . "\r\n";
                echo '            <td>' . '<input type="image" src="img/edit.png" value="" onclick="document.getElementById(\'purpose' . $purprow['purpose_id'] . '\').action =\'edt_purpose.html\';"' . '>' . '</td>' . "\r\n";
                echo '            <td>' . '<input type="image" src="img/delete.png" value="" onclick="document.getElementById(\'purpose' . $purprow['purpose_id'] . '\').action =\'del_purpose.php\';"' . '>'  . '</td>' . "\r\n" .  '          </tr>' ;
                echo "\r\n" . '          </form>';
            }
            echo "\r\n";
          ?>
        </table>
      </td>
    </tr>
    <tr>
      <td>
        <table>
          <tr>
            <td><b>Statuses</b></td>
            <td><b>Edit</b></td>
            <td><b>Delete</b></td>
            <td><form id="add_status" method="post"><input type="hidden" name="referer" value="set_gen.html"><input type="image" src="img/add.png" value="" onclick="document.getElementById('add_status').action = 'add_status.html';"></form></td>
          </tr>
          <?php
            while ($statrow = pg_fetch_assoc($qry_stat)) {
                echo "\r\n" . '          <form id="status' . $statrow['status_id'] . '" method="post">' . "\r\n" . '            <input type="hidden" name="referer" value="set_gen.html">';
                echo "\r\n" . '          <tr>' . "\r\n" . '            <td>' . $statrow['status'] . '</td>' . "\r\n" . '                <input type="hidden" name="status_id" value="' . $statrow['status_id'] . '">' . "\r\n" . '                <input type="hidden" name="status" value="' . $statrow['status'] . '">' . "\r\n";
                echo '            <td>' . '<input type="image" src="img/edit.png" value="" onclick="document.getElementById(\'status' . $statrow['status_id'] . '\').action =\'edt_status.html\';"' . '>'  . '</td>' . "\r\n";
                echo '            <td>' . '<input type="image" src="img/delete.png" value="" onclick="document.getElementById(\'status' . $statrow['status_id'] . '\').action =\'del_status.php\';"' . '>'  . '</td>' . "\r\n" .  '          </tr>' ;
                echo "\r\n" . '          </form>';
            }
            echo "\r\n";
          ?>

        </table>
      </td>
    </tr>
  </table>
</table>
</body>
</html>
